(function(){tinymce.create("tinymce.plugins.MediaSelectionPlugin",{ed:null,imageCls:"tinymce-editor-image",linkCls:"tinymce-editor-link",videoCls:"tinymce-editor-video",audioCls:"tinymce-editor-audio",init:function(e,t){var n=this;n.ed=e;e.addCommand("mceMediaSelection",function(){var r=false;if(typeof Shopware.app.Application.addSubApplication!=="function"){Ext.Error.raise({msg:"Your ExtJS application does not support sub applications",option:[e,t]})}if(n.ed.settings&&n.ed.settings.fullscreen_is_enabled){r=true}Shopware.app.Application.addSubApplication({name:"Shopware.apps.MediaManager",layout:"small",forceToFront:r,selectionMode:"single",eventScope:n,mediaSelectionCallback:n._processImage})});e.addButton("media_selection",{title:"Media Selection",cls:"tinymce-media-selection",cmd:"mceMediaSelection",image:t+"/icons/inbox-image.png"})},getInfo:function(){return{longname:"MediaManager - MediaSelection",author:"shopware AG - st.pohl",authorurl:"http://www.shopware.de",infourl:"http://wiki.shopware.de/",version:"1.0.0"}},_processImage:function(e){var t=this,n=t.ed,r=e.up("window"),i=r.down(".mediamanager-media-view"),s=i.dataView,o=s.getSelectionModel(),u=o.getSelection();Ext.each(u,function(e){var r=e.get("type");if(r==="VIDEO"){t._insertVideo(e)}else if(r==="IMAGE"){t._insertImage(e)}else if(r==="MUSIC"){t._insertAudio(e)}else{t._insertLink(e)}n.undoManager.add()});r.destroy()},_insertImage:function(e){var t=this,n=t.ed,r=n.settings,i,s;if(r.document_base_url.length&&r.relative_urls==false){i=r.document_base_url+e.get("path")}else i=e.get("path");s={"class":t.imageCls,width:e.get("width"),height:e.get("height"),alt:e.get("name"),src:i};n.execCommand("mceInsertContent",false,tinymce.DOM.createHTML("img",s),{skip_undo:1});return true},_insertLink:function(e){var t=this,n=t.ed,r;r={"class":t.linkCls,href:e.get("path"),title:e.get("name"),target:"_blank"};n.execCommand("mceInsertContent",false,tinymce.DOM.createHTML("a",r,e.get("name")),{skip_undo:1});return true},_insertVideo:function(e){var t=this,n=t.ed,r;r={"class":t.videoCls,width:320,height:240,src:n.settings.document_base_url+e.get("path"),controls:true};n.execCommand("mceInsertContent",false,tinymce.DOM.createHTML("video",r),{skip_undo:1});return true},_insertAudio:function(e){var t=this,n=t.ed,r;r={"class":t.audioCls,src:n.settings.document_base_url+e.get("path"),controls:true};n.execCommand("mceInsertContent",false,tinymce.DOM.createHTML("audio",r),{skip_undo:1});return true}});tinymce.PluginManager.add("media_selection",tinymce.plugins.MediaSelectionPlugin)})()